<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Astrology Birth Chart Calculator</title>
<style>
body {
background-color: #000;
color: #fff;
font-family: 'Georgia', serif;
margin: 0;
padding: 20px;
background-image: url('https://images.unsplash.com/photo-1505506874110-6a7a69039b08?auto=format&fit=crop&q=80');
background-size: cover;
background-attachment: fixed;
direction: ltr;
}
.rtl { direction: rtl; font-family: 'Arial', sans-serif; }
h1, h2 { text-align: center; color: #ffd700; }
form {
max-width: 420px; margin: 0 auto 40px; padding: 30px;
background: rgba(20, 20, 40, 0.85);
border-radius: 16px;
box-shadow: 0 8px 32px rgba(0,0,0,0.6);
backdrop-filter: blur(8px);
}
label { display: block; margin: 12px 0 6px; font-weight: bold; color: #ddd; }
input, select {
width: 100%; padding: 12px; margin-bottom: 16px;
border: 1px solid #555; border-radius: 8px;
background: #111; color: #fff; font-size: 16px;
box-sizing: border-box;
}
.date-time { display: flex; gap: 8px; }
.date-time > * { flex: 1; }
button {
width: 100%;
padding: 14px;
background: linear-gradient(135deg, #6a1b9a, #4b0082);
color: #fff;
border: none;
border-radius: 8px;
font-size: 18px;
font-weight: bold;
cursor: pointer;
transition: all 0.3s;
}
button:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(106, 27, 154, 0.5); }
#chart { max-width: 800px; margin: 0 auto 40px; text-align: center; }
#positions, #aspects, #lots, #interpretations {
max-width: 800px;
margin: 30px auto;
background: rgba(20, 20, 40, 0.75);
padding: 25px;
border-radius: 16px;
backdrop-filter: blur(8px);
}
ul { list-style: none; padding: 0; }
li { margin: 8px 0; color: #add8e6; font-size: 1.05em; }
footer { text-align: center; margin-top: 40px; font-size: 0.9em; color: #aaa; }
footer a { color: #ffd700; text-decoration: none; }
#consentBanner {
position: fixed; bottom: 0; left: 0; right: 0;
background: rgba(0,0,0,0.9);
padding: 20px;
text-align: center;
box-shadow: 0 -4px 10px rgba(0,0,0,0.5);
z-index: 9999;
}
#consentBanner button { margin: 10px; padding: 10px 20px; border-radius: 5px; }
#consentBanner #acceptBtn { background: #4b0082; }
#consentBanner #declineBtn { background: #333; }
#languageSelector {
position: absolute; top: 20px; right: 20px;
padding: 8px; background: #111; border-radius: 5px;
}
.hint { font-size: 0.9em; color: #ccc; margin-top: -8px; margin-bottom: 16px; }
.error { color: #ffb3b3; }
@media (max-width: 600px) {
form { padding: 20px; }
.date-time { flex-direction: column; gap: 0; }
.date-time > * { width: 100%; }
}
</style>
</head>
<body>
<select id="languageSelector">
<option value="en">English</option>
<option value="he">עברית</option>
</select>

<h1 data-en="Astrology Birth Chart Calculator" data-he="מחשבון מפת לידה אסטרולוגית">Astrology Birth Chart Calculator</h1>

<form id="birthForm">
<label for="name" data-en="My name is:" data-he="השם שלי הוא:">My name is:</label>
<input type="text" id="name" data-en-placeholder="Optional" data-he-placeholder="אופציונלי" />

<label data-en="My date of birth is:" data-he="תאריך הלידה שלי הוא:">My date of birth is:</label>
<div class="date-time">
<select id="month" required>
<option value="">MM</option>
<option value="1">01</option><option value="2">02</option><option value="3">03</option>
<option value="4">04</option><option value="5">05</option><option value="6">06</option>
<option value="7">07</option><option value="8">08</option><option value="9">09</option>
<option value="10">10</option><option value="11">11</option><option value="12">12</option>
</select>
<select id="day" required>
<option value="">DD</option>
</select>
<input type="number" id="year" data-en-placeholder="YYYY" data-he-placeholder="שנה" min="1900" max="2100" required />
</div>

<label data-en="Birth Time:" data-he="שעת לידה:">Birth Time:</label>
<div class="date-time">
<select id="hour" required>
<option value="">hh</option>
<option value="1">1</option><option value="2">2</option><option value="3">3</option>
<option value="4">4</option><option value="5">5</option><option value="6">6</option>
<option value="7">7</option><option value="8">8</option><option value="9">9</option>
<option value="10">10</option><option value="11">11</option><option value="12">12</option>
</select>
<select id="minute" required>
<option value="">mm</option>
</select>
<select id="ampm" required>
<option value="AM" data-en="AM" data-he="בוקר">AM</option>
<option value="PM" data-en="PM" data-he="ערב">PM</option>
</select>
</div>

<label for="location" data-en="I was born in: (City, state, country)" data-he="נולדתי ב: (עיר, מדינה, ארץ)">I was born in: (City, state, country)</label>
<input type="text" id="location" required data-en-placeholder="e.g. Donetsk, Ukraine" data-he-placeholder="למשל, דונצק, אוקראינה" />
<div class="hint" id="locHint" data-en="Pick a suggestion from the dropdown so we can get exact coordinates." data-he="בחר/י הצעה מהרשימה כדי שנוכל לקבל קואורדינטות מדויקות.">
Pick a suggestion from the dropdown so we can get exact coordinates.
</div>

<input type="hidden" id="lat" />
<input type="hidden" id="lon" />
<input type="hidden" id="tz" />

<div class="hint" id="errBox" style="display:none;"></div>

<button type="submit" data-en="Create Chart" data-he="צור מפה">Create Chart</button>
</form>

<div id="chart">
<svg id="chartSvg" width="600" height="600"></svg>
</div>

<div id="positions">
<h2 data-en="Planetary Positions" data-he="מיקומי כוכבים">Planetary Positions</h2>
<ul id="posList"></ul>
</div>

<div id="aspects">
<h2 data-en="Aspects" data-he="אספקטים">Aspects</h2>
<ul id="aspList"></ul>
</div>

<div id="lots">
<h2 data-en="Arabic Lots (Medieval Techniques)" data-he="חלקים ערביים (טכניקות ימי הביניים)">Arabic Lots (Medieval Techniques)</h2>
<ul id="lotList"></ul>
</div>

<div id="interpretations">
<h2 data-en="Interpretations (From Literature)" data-he="פרשנויות (מהספרות)">Interpretations (From Literature)</h2>
<p id="interpText"></p>
</div>

<footer>
<a href="privacy.html" data-en="Privacy Policy" data-he="מדיניות פרטיות">Privacy Policy</a>
</footer>

<div id="consentBanner">
<p data-en="We use your birth data only for calculating your chart (no storage or sharing). By using this site, you consent to our Privacy Policy."
data-he="אנו משתמשים בנתוני הלידה שלך רק לחישוב המפה שלך (ללא אחסון או שיתוף). בשימוש באתר זה, אתה מסכים למדיניות הפרטיות שלנו.">
We use your birth data only for calculating your chart (no storage or sharing). By using this site, you consent to our
<a href="privacy.html" style="color:#ffd700">Privacy Policy</a>.
</p>
<button id="acceptBtn" data-en="Accept" data-he="אשר">Accept</button>
<button id="declineBtn" data-en="Decline" data-he="סרב">Decline</button>
</div>

<!-- libs -->
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://unpkg.com/astronomy-engine@2.1.3/browser/astronomy-browser.js"></script>

<script>
/**********************
* Helpers & Globals
**********************/
const signsEn = ['Aries','Taurus','Gemini','Cancer','Leo','Virgo','Libra','Scorpio','Sagittarius','Capricorn','Aquarius','Pisces'];
const signsHe = ['טלה','שור','תאומים','סרטן','אריה','בתולה','מאזניים','עקרב','קשת','גדי','דלי','דגים'];

const planetNames = {
en: {Sun:'Sun', Moon:'Moon', Mercury:'Mercury', Venus:'Venus', Mars:'Mars', Jupiter:'Jupiter', Saturn:'Saturn', Uranus:'Uranus', Neptune:'Neptune', Pluto:'Pluto', Node:'North Node', Asc:'Ascendant', MC:'MC'},
he: {Sun:'שמש', Moon:'ירח', Mercury:'כוכב חמה', Venus:'נוגה', Mars:'מאדים', Jupiter:'צדק', Saturn:'שבתאי', Uranus:'אורנוס', Neptune:'נפטון', Pluto:'פלוטו', Node:'צומת צפוני', Asc:'אסנדנט', MC:'MC'}
};

const aspectTypes = {
0: { en:'Conjunction', he:'חיבור', orb: 8 },
60: { en:'Sextile', he:'משושה', orb: 5 },
90: { en:'Square', he:'ריבוע', orb: 6 },
120:{ en:'Trine', he:'משולש', orb: 6 },
180:{ en:'Opposition', he:'ניגוד', orb: 8 }
};

// Traditional rulerships
const signRulers = {
Aries:'Mars', Taurus:'Venus', Gemini:'Mercury', Cancer:'Moon', Leo:'Sun', Virgo:'Mercury',
Libra:'Venus', Scorpio:'Mars', Sagittarius:'Jupiter', Capricorn:'Saturn', Aquarius:'Saturn', Pisces:'Jupiter'
};

function norm360(x){ x%=360; if(x<0) x+=360; return x; }
function degToRad(d){ return d*Math.PI/180; }
function radToDeg(r){ return r*180/Math.PI; }
function pad2(n){ return String(n).padStart(2,'0'); }
function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

function formatLon(lon, lang){
const sIndex = Math.floor(norm360(lon)/30);
const degInSign = norm360(lon) - sIndex*30;
const deg = Math.floor(degInSign);
const min = Math.floor((degInSign - deg)*60);
const sign = (lang==='he'?signsHe:signsEn)[sIndex];
return `${deg}°${pad2(min)} ${sign}`;
}

function setError(msg){
const box = document.getElementById('errBox');
if(!msg){
box.style.display='none';
box.classList.remove('error');
box.textContent='';
return;
}
box.style.display='block';
box.classList.add('error');
box.textContent = msg;
}

// For “regenerate on language switch”
let lastChartState = null;

/**********************
* Language switching
**********************/
let currentLang = localStorage.getItem('language') || (navigator.language.startsWith('he') ? 'he' : 'en');
document.getElementById('languageSelector').value = currentLang;

function switchLanguage(lang) {
currentLang = lang;
document.body.classList.toggle('rtl', lang === 'he');
document.querySelectorAll('[data-en]').forEach(el => {
el.innerHTML = el.getAttribute(`data-${lang}`) || el.getAttribute('data-en');
});
document.querySelectorAll('[data-en-placeholder]').forEach(el => {
el.placeholder = el.getAttribute(`data-${lang}-placeholder`) || el.getAttribute('data-en-placeholder');
});
localStorage.setItem('language', lang);

if (lastChartState) {
renderAll(lastChartState); // re-render text labels in the chosen language
}
}
document.getElementById('languageSelector').addEventListener('change', (e) => switchLanguage(e.target.value));
switchLanguage(currentLang);

/**********************
* Consent banner
**********************/
if (!localStorage.getItem('consentGiven')) {
document.getElementById('birthForm').style.display = 'none';
document.getElementById('consentBanner').style.display = 'block';
} else {
document.getElementById('consentBanner').style.display = 'none';
}

document.getElementById('acceptBtn').addEventListener('click', () => {
localStorage.setItem('consentGiven', 'true');
document.getElementById('consentBanner').style.display = 'none';
document.getElementById('birthForm').style.display = 'block';
});

document.getElementById('declineBtn').addEventListener('click', () => {
alert(currentLang === 'en'
? 'You must accept the privacy policy to use this site.'
: 'עליך לאשר את מדיניות הפרטיות כדי להשתמש באתר זה.');
});

/**********************
* Populate day/minute
**********************/
const daySelect = document.getElementById('day');
for (let i=1;i<=31;i++) daySelect.options.add(new Option(i<10?'0'+i:String(i), String(i)));
const minuteSelect = document.getElementById('minute');
for (let i=0;i<60;i++) minuteSelect.options.add(new Option(i<10?'0'+i:String(i), String(i)));

/**********************
* Google Places (stable init)
* - we define initAutocomplete globally
* - Google script loads with callback=initAutocomplete
**********************/
let placesAutocomplete = null;

window.initAutocomplete = function initAutocomplete() {
try {
const input = document.getElementById('location');
placesAutocomplete = new google.maps.places.Autocomplete(input, {
fields: ['geometry','formatted_address','utc_offset_minutes','name']
});
placesAutocomplete.addListener('place_changed', () => {
const place = placesAutocomplete.getPlace();
if (!place || !place.geometry) {
setError(currentLang==='en' ? 'Please select a location from the dropdown.' : 'אנא בחר/י מיקום מהרשימה.');
return;
}
setError(null);
const lat = place.geometry.location.lat();
const lon = place.geometry.location.lng();
document.getElementById('lat').value = lat;
document.getElementById('lon').value = lon;

// utc_offset_minutes is often missing in modern Places. We'll compute timezone via Time Zone API on submit.
document.getElementById('tz').value = '';
});
} catch (err) {
console.error(err);
setError(currentLang==='en'
? 'Google Places failed to initialize. Check your API key / restrictions.'
: 'אתחול Google Places נכשל. בדוק/י מפתח API והגבלות.');
}
};

/**********************
* Timezone by lat/lon + timestamp (best practice)
**********************/
async function fetchTimeZoneOffsetHours({lat, lon, utcTimestampSeconds, apiKey}) {
const url =
`https://maps.googleapis.com/maps/api/timezone/json?location=${encodeURIComponent(lat + ',' + lon)}&timestamp=${encodeURIComponent(utcTimestampSeconds)}&key=${encodeURIComponent(apiKey)}`;

const res = await fetch(url);
if (!res.ok) throw new Error('Timezone HTTP error');
const data = await res.json();

if (data.status !== 'OK') {
throw new Error(`Timezone API: ${data.status}${data.errorMessage ? ' - '+data.errorMessage : ''}`);
}
// rawOffset + dstOffset are seconds
const totalSeconds = (data.rawOffset || 0) + (data.dstOffset || 0);
return totalSeconds / 3600;
}

/**********************
* Core astronomy: planets
**********************/
function getPlanetLon(body, time) {
// Ecliptic longitude, geocentric
const vec = Astronomy.GeoVector(body, time, false);
const ecl = Astronomy.Ecliptic(vec);
return norm360(ecl.elon);
}

function getNodeLon(time) {
// True Node: Astronomy Engine has MoonNode() (ascending), if present in this build.
// Fallback: mean node approximate if missing.
if (Astronomy.MoonNode) {
const node = Astronomy.MoonNode(time);
return norm360(node);
}
// fallback: just return 0 with a warning
console.warn('MoonNode not available in this Astronomy Engine build.');
return 0;
}

/**********************
* ASC/MC + houses
* - Uses sidereal time + obliquity
* - Houses: Equal House from ASC (stable for MVP)
**********************/
function meanObliquityDeg(time) {
// A good approximation; Astronomy Engine also has EarthTilt(time) in some builds.
// We'll use a standard polynomial based on Julian centuries from J2000.
const jd = Astronomy.JulianDay(time);
const T = (jd - 2451545.0)/36525.0;
const epsArcsec = 84381.448 - 46.8150*T - 0.00059*T*T + 0.001813*T*T*T;
return epsArcsec/3600.0;
}

function localSiderealTimeDeg(time, lonDegEast) {
// Astronomy Engine has SiderealTime(time) returning hours.
// We'll convert to degrees and add longitude.
const gstHours = Astronomy.SiderealTime(time);
const gstDeg = norm360(gstHours*15);
return norm360(gstDeg + lonDegEast);
}

function ascendantDeg(lstDeg, latDeg, epsDeg) {
// Formula: Asc = atan2( cos(eps)*sin(theta) - tan(phi)*sin(eps), cos(theta) )
// theta = LST (in radians), phi = latitude
const theta = degToRad(lstDeg);
const phi = degToRad(latDeg);
const eps = degToRad(epsDeg);

const y = Math.cos(eps)*Math.sin(theta) - Math.tan(phi)*Math.sin(eps);
const x = Math.cos(theta);
const asc = radToDeg(Math.atan2(y, x));
return norm360(asc);
}

function midheavenDeg(lstDeg, epsDeg) {
// MC ≈ arctan2( sin(theta)*cos(eps), cos(theta) )
const theta = degToRad(lstDeg);
const eps = degToRad(epsDeg);
const y = Math.sin(theta)*Math.cos(eps);
const x = Math.cos(theta);
const mc = radToDeg(Math.atan2(y, x));
return norm360(mc);
}

function equalHousesFromAsc(asc) {
const cusps = [];
for (let i=0;i<12;i++) cusps.push(norm360(asc + i*30));
return cusps; // house 1 cusp = asc, house 10 cusp = asc+270, etc.
}

/**********************
* Aspects
**********************/
function angleDiff(a,b){
let d = Math.abs(norm360(a)-norm360(b));
if (d>180) d = 360-d;
return d;
}

function computeAspects(planets) {
// planets: [{key:'Sun', lon:...}, ...]
const major = [0,60,90,120,180];
const out = [];
for (let i=0;i<planets.length;i++){
for (let j=i+1;j<planets.length;j++){
const A = planets[i], B = planets[j];
const d = angleDiff(A.lon, B.lon);

for (const asp of major) {
const baseOrb = aspectTypes[asp].orb;
const lumOrb = (A.key==='Sun'||A.key==='Moon'||B.key==='Sun'||B.key==='Moon') ? 1.5 : 0;
const orb = baseOrb + lumOrb;
const delta = Math.abs(d - asp);
if (delta <= orb) {
out.push({a:A.key, b:B.key, type:asp, orb:delta});
break;
}
}
}
}
return out.sort((x,y)=>x.orb-y.orb);
}

/**********************
* Lots (your list)
* NOTE: This is the exact array from your uploaded index file.
**********************/
const lotsDefinitions = [
{ nameEn: 'Puṇya (Fortune)', nameHe: 'חלק המזל (פורטונה)', meaningEn: 'Luck, prosperity, health and general well-being', meaningHe: 'מזל, שגשוג, בריאות ורווחה כללית', day: longs => longs.asc + longs.moon - longs.sun, night: longs => longs.asc + longs.sun - longs.moon },
{ nameEn: 'Guru (Teacher)', nameHe: 'חלק המורה', meaningEn: 'Teacher or spiritual guide, mentors, gurus, wisdom path', meaningHe: 'מורה או מדריך רוחני, מנטורים, גורו, דרך חוכמה', day: longs => longs.asc + longs.jup - longs.sun, night: longs => longs.asc + longs.sun - longs.jup },
{ nameEn: 'Jñāna/Vidyā (Knowledge)', nameHe: 'חלק הידע', meaningEn: 'Knowledge and learning, education, scholarship', meaningHe: 'ידע ולמידה, חינוך, מלגה', day: longs => longs.asc + longs.merc - longs.sun, night: longs => longs.asc + longs.sun - longs.merc },
{ nameEn: 'Yaśas (Renown)', nameHe: 'חלק התהילה', meaningEn: 'Fame/Reputation, honor, glory and how one is known', meaningHe: 'תהילה/מוניטין, כבוד, תפארת ואיך אדם ידוע', day: longs => longs.asc + longs.jup - longs.punya, night: longs => longs.asc + longs.punya - longs.jup },
{ nameEn: 'Mitra (Friends)', nameHe: 'חלק החברים', meaningEn: 'Friendship, allies, friends and social networks', meaningHe: 'ידידות, בעלי ברית, חברים ורשתות חברתיות', day: longs => longs.asc + longs.ven - longs.merc, night: longs => longs.asc + longs.merc - longs.ven },
{ nameEn: 'Māhātmya (Greatness)', nameHe: 'חלק הגדולה', meaningEn: 'Greatness or magnanimity, prestige, nobility or grand achievements', meaningHe: 'גדולה או נדיבות, יוקרה, אצילות או הישגים גדולים', day: longs => longs.asc + longs.punya - longs.mars, night: longs => longs.asc + longs.mars - longs.punya },
{ nameEn: 'Āśā (Hope)', nameHe: 'חלק התקווה', meaningEn: 'Hope and expectations; aspirations and optimism for the future', meaningHe: 'תקווה וציפיות; שאיפות ואופטימיות לעתיד', day: longs => longs.asc + longs.sat - longs.ven, night: longs => longs.asc + longs.ven - longs.sat },
{ nameEn: 'Samarthatā (Ability)', nameHe: 'חלק היכולת', meaningEn: 'Ability/Capability, skill, talent and competence', meaningHe: 'יכולת/מסוגלות, מיומנות, כישרון וכשירות', day: longs => longs.asc + longs.mars - longs.merc, night: longs => longs.asc + longs.merc - longs.mars },
{ nameEn: 'Bhrātṛ (Brothers)', nameHe: 'חלק האחים', meaningEn: 'Siblings (especially brothers), experiences due to brothers', meaningHe: 'אחים (במיוחד אחים), חוויות בשל אחים', day: longs => longs.asc + longs.jup - longs.sat, night: longs => longs.asc + longs.jup - longs.sat },
{ nameEn: 'Gaurava (Honor)', nameHe: 'חלק הכבוד', meaningEn: 'Honor/Dignity, respect, social standing and recognition', meaningHe: 'כבוד/כבוד, כבוד, מעמד חברתי והכרה', day: longs => longs.asc + longs.sat - longs.sun, night: longs => longs.asc + longs.sun - longs.sat },
{ nameEn: 'Rājya (Dominion)', nameHe: 'חלק הממלכה', meaningEn: 'Kingdom/Authority, power, career success, leadership', meaningHe: 'ממלכה/סמכות, כוח, הצלחה בקריירה, מנהיגות', day: longs => longs.asc + longs.sat - longs.sun, night: longs => longs.asc + longs.sun - longs.sat },
{ nameEn: 'Pitṛ/Tāta (Father)', nameHe: 'חלק האב', meaningEn: 'Father, father’s well-being or influence, paternal lineage', meaningHe: 'אב, רווחת האב או השפעתו, שושלת אבהית', day: longs => longs.asc + longs.sat - longs.sun, night: longs => longs.asc + longs.sun - longs.sat },
{ nameEn: 'Mātṛ (Mother)', nameHe: 'חלק האם', meaningEn: 'Mother, mother’s influence, upbringing, maternal family', meaningHe: 'אם, השפעת האם, גידול, משפחה אמהית', day: longs => longs.asc + longs.moon - longs.ven, night: longs => longs.asc + longs.ven - longs.moon },
{ nameEn: 'Suta (Children)', nameHe: 'חלק הילדים', meaningEn: 'Children, offspring, fertility and relationship with children', meaningHe: 'ילדים, צאצאים, פוריות וקשר עם ילדים', day: longs => longs.asc + longs.jup - longs.sat, night: longs => longs.asc + longs.jup - longs.sat },
{ nameEn: 'Jīvita (Life)', nameHe: 'חלק החיים', meaningEn: 'Life, vitality, life force, longevity and general life path themes', meaningHe: 'חיים, חיוניות, כוח חיים, אריכות ימים ונושאים כלליים של דרך חיים', day: longs => longs.asc + longs.sat - longs.jup, night: longs => longs.asc + longs.jup - longs.sat },
{ nameEn: 'Ambu/Jala (Water)', nameHe: 'חלק המים', meaningEn: 'Water, matters related to water (crossing seas, voyages, emotions)', meaningHe: 'מים, עניינים הקשורים למים (חציית ימים, מסעות, רגשות)', day: longs => longs.asc + 105 - longs.sat, night: longs => longs.asc + longs.sat - 105 },
{ nameEn: 'Karman (Work)', nameHe: 'חלק העבודה', meaningEn: 'Work (Karma), work, deeds, career labor and toil', meaningHe: 'עבודה (קארמה), עבודה, מעשים, עבודת קריירה ועמל', day: longs => longs.asc + longs.mars - longs.merc, night: longs => longs.asc + longs.merc - longs.mars },
{ nameEn: 'Roga/Māndya (Illness)', nameHe: 'חלק המחלה', meaningEn: 'Illness, disease, health issues and ailments', meaningHe: 'מחלה, מחלה, בעיות בריאות ומחלות', day: longs => longs.asc + longs.asc - longs.moon, night: longs => longs.asc + longs.moon - longs.asc },
{ nameEn: 'Manmatha (Desire)', nameHe: 'חלק התשוקה', meaningEn: 'Desire (Manmatha god of love), passion, sexual desire, attraction', meaningHe: 'תשוקה (אלוהי האהבה מנמתה), תשוקה, תשוקה מינית, משיכה', day: longs => longs.asc + longs.ven - longs.sat, night: longs => longs.asc + longs.ven - longs.sat },
{ nameEn: 'Kali/Jhaḳaṭaka (Strife)', nameHe: 'חלק המריבה', meaningEn: 'Strife/Quarrel, conflicts, disputes and strife', meaningHe: 'מריבה/ריב, סכסוכים, מחלוקות ומריבה', day: longs => longs.asc + longs.jup - longs.mars, night: longs => longs.asc + longs.mars - longs.jup },
{ nameEn: 'Kṣama (Forbearance)', nameHe: 'חלק הסבלנות', meaningEn: 'Forbearance (Patience/Forgiveness), capacity to endure, forgive', meaningHe: 'סבלנות (סבלנות/סליחה), יכולת לסבול, לסלוח', day: longs => longs.asc + longs.sat - longs.punya, night: longs => longs.asc + longs.punya - longs.sat },
{ nameEn: 'Śāstra (Instruction)', nameHe: 'חלק ההוראה', meaningEn: 'Instruction (or Scriptures), learning, knowledge of sciences or scriptures', meaningHe: 'הוראה (או כתבי קודש), למידה, ידע במדעים או כתבי קודש', day: longs => longs.asc + longs.jup - longs.sat, night: longs => longs.asc + longs.sat - longs.jup },
{ nameEn: 'Sa-bandhu (Kinsmen)', nameHe: 'חלק הקרובים', meaningEn: 'Kinsfolk/Relatives, extended family, cousins, allies by blood', meaningHe: 'קרובי משפחה/קרובים, משפחה מורחבת, בני דודים, בעלי ברית בדם', day: longs => longs.asc + longs.merc - longs.moon, night: longs => longs.asc + longs.moon - longs.merc },
{ nameEn: 'Bandaka/Banda (Serfs)', nameHe: 'חלק המשרתים', meaningEn: 'Servants (or subordinates), servants, employees', meaningHe: 'משרתים (או כפופים), משרתים, עובדים', day: longs => longs.asc + longs.moon - longs.merc, night: longs => longs.asc + longs.moon - longs.merc },
{ nameEn: 'Mṛtyu (Death)', nameHe: 'חלק המוות', meaningEn: 'Death, matters of death, mortality and dangerous circumstances', meaningHe: 'מוות, ענייני מוות, תמותה ומצבים מסוכנים', day: longs => longs.asc + longs.house8 - longs.sat, night: longs => longs.asc + longs.sat - longs.house8 },
{ nameEn: 'Deśāntara (Foreign Countries)', nameHe: 'חלק ארצות זרות', meaningEn: 'Foreign Travel/Abroad, journeys to distant lands, foreign residence', meaningHe: 'נסיעות זרות/חו"ל, מסעות לארצות רחוקות, מגורים זרים', day: longs => longs.asc + longs.house9 - longs.lord9, night: longs => longs.asc + longs.house9 - longs.lord9 },
{ nameEn: 'Dhana/Artha (Wealth)', nameHe: 'חלק העושר', meaningEn: 'Wealth, finance, money, possessions and material gains', meaningHe: 'עושר, כספים, כסף, רכוש ורווחים חומריים', day: longs => longs.asc + longs.house2 - longs.lord2, night: longs => longs.asc + longs.house2 - longs.lord2 },
{ nameEn: 'Anyadāra (Others’ Wives)', nameHe: 'חלק נשות אחרים', meaningEn: 'Others’ Spouses, interactions with other people’s partners', meaningHe: 'בני זוג של אחרים, אינטראקציות עם בני זוג של אחרים', day: longs => longs.asc + longs.ven - longs.sun, night: longs => longs.asc + longs.ven - longs.sun },
{ nameEn: 'Anyakarman (Others’ Work)', nameHe: 'חלק עבודת אחרים', meaningEn: 'Others’ Work/Business, involved in another person’s work', meaningHe: 'עבודה/עסקים של אחרים, מעורבות בעבודה של אדם אחר', day: longs => longs.asc + longs.mars - longs.merc, night: longs => longs.asc + longs.merc - longs.mars },
{ nameEn: 'Vaṇij (Merchants)', nameHe: 'חלק הסוחרים', meaningEn: 'Merchants/Trade, commerce, business dealings, trade profits', meaningHe: 'סוחרים/מסחר, מסחר, עסקאות עסקיות, רווחי מסחר', day: longs => longs.asc + longs.merc - longs.moon, night: longs => longs.asc + longs.moon - longs.merc },
{ nameEn: 'Kāryasiddhi (Success)', nameHe: 'חלק ההצלחה', meaningEn: 'Success in Undertakings, outcome of endeavors', meaningHe: 'הצלחה במפעלים, תוצאה של מאמצים', day: longs => longs.asc + longs.jup - longs.sat, night: longs => longs.asc + longs.jup - longs.sat },
{ nameEn: 'Udvāha/Vivāha (Marriage)', nameHe: 'חלק הנישואין', meaningEn: 'Marriage, one’s spouse and marital happiness', meaningHe: 'נישואין, בן זוגו של האדם ואושר נישואין', day: longs => longs.asc + longs.ven - longs.sat, night: longs => longs.asc + longs.ven - longs.sat },
{ nameEn: 'Sūti/Prasūti (Birth)', nameHe: 'חלק הלידה', meaningEn: 'Childbirth/Birth, matters around pregnancy, giving birth', meaningHe: 'לידה/לידה, עניינים סביב הריון, ילודה', day: longs => longs.asc + longs.jup - longs.moon, night: longs => longs.asc + longs.jup - longs.moon },
{ nameEn: 'Santāpa (Affliction)', nameHe: 'חלק הסבל', meaningEn: 'Suffering/Grief, sorrow, mental distress and afflictions', meaningHe: 'סבל/צער, צער, מצוקה נפשית ומצוקות', day: longs => longs.asc + longs.sat - longs.moon, night: longs => longs.asc + longs.moon - longs.sat },
{ nameEn: 'Śraddhā (Faith)', nameHe: 'חלק האמונה', meaningEn: 'Faith/Belief, trust, religious faith, sincerity and convictions', meaningHe: 'אמונה/אמונה, אמון, אמונה דתית, כנות והרשעות', day: longs => longs.asc + longs.jup - longs.moon, night: longs => longs.asc + longs.moon - longs.jup },
{ nameEn: 'Prīti (Love)', nameHe: 'חלק האהבה', meaningEn: 'Love and Affection, romantic love, devotion, attachments', meaningHe: 'אהבה וחיבה, אהבה רומנטית, מסירות, קשרים', day: longs => longs.asc + longs.ven - longs.moon, night: longs => longs.asc + longs.moon - longs.ven },
{ nameEn: 'Bala (Force)', nameHe: 'חלק הכוח', meaningEn: 'Force/Strength, physical strength, courage, military force', meaningHe: 'כוח/חוזק, כוח פיזי, אומץ, כוח צבאי', day: longs => longs.asc + longs.mars - longs.sat, night: longs => longs.asc + longs.sat - longs.mars },
{ nameEn: 'Tanu/Deha (Body)', nameHe: 'חלק הגוף', meaningEn: 'Body/Health, condition of body, physical constitution', meaningHe: 'גוף/בריאות, מצב הגוף, מבנה גופני', day: longs => longs.asc + longs.asc - longs.moon, night: longs => longs.asc + longs.moon - longs.asc },
{ nameEn: 'Jāḍya (Dullness)', nameHe: 'חלק העצלות', meaningEn: 'Stupidity/Inertia, ignorance, dull-wittedness, lethargy', meaningHe: 'טיפשות/אינרציה, בורות, קהות חושים, עייפות', day: longs => longs.asc + longs.sat - longs.merc, night: longs => longs.asc + longs.merc - longs.sat },
{ nameEn: 'Vyāpāra (Occupation)', nameHe: 'חלק העיסוק', meaningEn: 'Occupation/Trade, profession or business dealings', meaningHe: 'עיסוק/מסחר, מקצוע או עסקאות עסקיות', day: longs => longs.asc + longs.mars - longs.merc, night: longs => longs.asc + longs.merc - longs.mars },
{ nameEn: 'Pānīya-patana (Falling Into Water)', nameHe: 'חלק נפילה למים', meaningEn: 'Falling in Water, risk of drowning or water accidents', meaningHe: 'נפילה למים, סיכון טביעה או תאונות מים', day: longs => longs.asc + 105 - longs.sat, night: longs => longs.asc + longs.sat - 105 },
{ nameEn: 'Ripu (Enemies)', nameHe: 'חלק האויבים', meaningEn: 'Enemies, open enemies, opponents, harm from them', meaningHe: 'אויבים, אויבים גלויים, יריבים, נזק מהם', day: longs => longs.asc + longs.mars - longs.sat, night: longs => longs.asc + longs.sat - longs.mars },
{ nameEn: 'Śaurya (Valour)', nameHe: 'חלק האומץ', meaningEn: 'Valor/Courage, bravery, heroism, success in combat', meaningHe: 'אומץ/אומץ, גבורה, גבורה, הצלחה בקרב', day: longs => longs.asc + longs.mars - longs.jup, night: longs => longs.asc + longs.jup - longs.mars },
{ nameEn: 'Upāya (Means)', nameHe: 'חלק האמצעים', meaningEn: 'Means/Strategy, resources, tactics to achieve goals', meaningHe: 'אמצעים/אסטרטגיה, משאבים, טקטיקות להשגת יעדים', day: longs => longs.asc + longs.jup - longs.sat, night: longs => longs.asc + longs.sat - longs.jup },
{ nameEn: 'Daridra (Poverty)', nameHe: 'חלק העוני', meaningEn: 'Poverty, destitution, losses, financial hardship', meaningHe: 'עוני, עוני, הפסדים, קושי כלכלי', day: longs => longs.asc + longs.punya - longs.merc, night: longs => longs.asc + longs.merc - longs.punya },
{ nameEn: 'Gurutā (Dignity)', nameHe: 'חלק הכבוד', meaningEn: 'Dignity/Gravity, authority, seriousness, personal dignity', meaningHe: 'כבוד/כבידה, סמכות, רצינות, כבוד אישי', day: longs => longs.asc + longs.sat - longs.jup, night: longs => longs.asc + longs.jup - longs.sat },
{ nameEn: 'Jalapatha/Ambupatha (Travel by Water)', nameHe: 'חלק מסע במים', meaningEn: 'Journeys by Water, voyages over sea or rivers', meaningHe: 'מסעות במים, הפלגות על ים או נהרות', day: longs => longs.asc + 105 - longs.sat, night: longs => longs.asc + longs.sat - 105 },
{ nameEn: 'Bandhana (Imprisonment)', nameHe: 'חלק הכלא', meaningEn: 'Captivity/Imprisonment, incarceration, restrictions', meaningHe: 'שביה/כלא, מאסר, הגבלות', day: longs => longs.asc + longs.punya - longs.sat, night: longs => longs.asc + longs.sat - longs.punya },
{ nameEn: 'Duhitṛ/Kanyā (Daughters)', nameHe: 'חלק הבנות', meaningEn: 'Daughters, matters related to daughter(s) or young girls', meaningHe: 'בנות, עניינים הקשורים לבת(ות) או נערות צעירות', day: longs => longs.asc + longs.ven - longs.moon, night: longs => longs.asc + longs.moon - longs.ven },
{ nameEn: 'Aśva (Horses)', nameHe: 'חלק הסוסים', meaningEn: 'Horses, matters concerning horses, vehicles or transport', meaningHe: 'סוסים, עניינים הנוגעים לסוסים, רכבים או תחבורה', day: longs => longs.asc + longs.mars - longs.moon, night: longs => longs.asc + longs.moon - longs.mars }
];

/**********************
* Drawing the wheel
**********************/
function drawChartSvg({svgId, planets, asc, mc, houseCusps}) {
const svg = d3.select('#'+svgId);
svg.selectAll('*').remove();

const W = +svg.attr('width');
const H = +svg.attr('height');
const cx = W/2, cy = H/2;
const R = Math.min(W,H)*0.45;
const ringOuter = R;
const ringInner = R*0.78;
const planetRing = R*0.62;

// helper mapping: astrology wheel usually has 0° Aries at left or right depending style.
// We'll put 0° Aries at the right (0 radians) and go counterclockwise.
// Convert lon => angle in radians:
function lonToAngleRad(lon){
// 0° => 0 rad (east). Increase CCW.
return degToRad(90 - lon); // rotate so Aries starts at top? visually nicer
}

// background circles
svg.append('circle').attr('cx',cx).attr('cy',cy).attr('r',ringOuter).attr('fill','rgba(0,0,0,0.25)').attr('stroke','#ffd700').attr('stroke-width',2);
svg.append('circle').attr('cx',cx).attr('cy',cy).attr('r',ringInner).attr('fill','none').attr('stroke','rgba(255,215,0,0.35)').attr('stroke-width',1.5);
svg.append('circle').attr('cx',cx).attr('cy',cy).attr('r',planetRing).attr('fill','none').attr('stroke','rgba(173,216,230,0.35)').attr('stroke-width',1);

// sign boundaries
for (let i=0;i<12;i++){
const lon = i*30;
const a = lonToAngleRad(lon);
const x1 = cx + ringInner*Math.cos(a);
const y1 = cy - ringInner*Math.sin(a);
const x2 = cx + ringOuter*Math.cos(a);
const y2 = cy - ringOuter*Math.sin(a);
svg.append('line').attr('x1',x1).attr('y1',y1).attr('x2',x2).attr('y2',y2)
.attr('stroke','rgba(255,215,0,0.35)').attr('stroke-width',1);

// sign labels
const midLon = lon + 15;
const am = lonToAngleRad(midLon);
const tx = cx + (ringOuter+14)*Math.cos(am);
const ty = cy - (ringOuter+14)*Math.sin(am);

const signLabel = (currentLang==='he'?signsHe:signsEn)[i];
svg.append('text')
.attr('x',tx).attr('y',ty)
.attr('fill','#ffd700')
.attr('font-size','10px')
.attr('text-anchor','middle')
.attr('dominant-baseline','middle')
.text(signLabel);
}

// house lines
for (let i=0;i<12;i++){
const lon = houseCusps[i];
const a = lonToAngleRad(lon);
const x1 = cx + 0*Math.cos(a);
const y1 = cy - 0*Math.sin(a);
const x2 = cx + ringInner*Math.cos(a);
const y2 = cy - ringInner*Math.sin(a);

svg.append('line')
.attr('x1',x1).attr('y1',y1).attr('x2',x2).attr('y2',y2)
.attr('stroke','rgba(173,216,230,0.35)')
.attr('stroke-width',1);

// house number labels
const mid = norm360(houseCusps[i] + 15);
const am = lonToAngleRad(mid);
const tx = cx + (ringInner*0.90)*Math.cos(am);
const ty = cy - (ringInner*0.90)*Math.sin(am);
svg.append('text')
.attr('x',tx).attr('y',ty)
.attr('fill','rgba(173,216,230,0.9)')
.attr('font-size','10px')
.attr('text-anchor','middle')
.attr('dominant-baseline','middle')
.text(String(i+1));
}

// ASC/MC markers
function marker(lon, label){
const a = lonToAngleRad(lon);
const x = cx + ringInner*Math.cos(a);
const y = cy - ringInner*Math.sin(a);
svg.append('circle').attr('cx',x).attr('cy',y).attr('r',4).attr('fill','#ffd700');
svg.append('text').attr('x',x).attr('y',y-10).attr('fill','#ffd700').attr('font-size','10px')
.attr('text-anchor','middle').text(label);
}
marker(asc, planetNames[currentLang].Asc);
marker(mc, planetNames[currentLang].MC);

// planets
planets.forEach(p=>{
const a = lonToAngleRad(p.lon);
const x = cx + planetRing*Math.cos(a);
const y = cy - planetRing*Math.sin(a);
svg.append('circle').attr('cx',x).attr('cy',y).attr('r',4).attr('fill','#add8e6');
svg.append('text')
.attr('x',x).attr('y',y-10)
.attr('fill','#add8e6')
.attr('font-size','10px')
.attr('text-anchor','middle')
.text(planetNames[currentLang][p.key] || p.key);
});
}

/**********************
* Render outputs
**********************/
function renderAll(state) {
// positions
const posList = document.getElementById('posList');
posList.innerHTML = '';
state.planets.forEach(p=>{
const li = document.createElement('li');
li.textContent = `${planetNames[currentLang][p.key] || p.key}: ${formatLon(p.lon, currentLang)}`;
posList.appendChild(li);
});

// aspects
const aspList = document.getElementById('aspList');
aspList.innerHTML = '';
state.aspects.forEach(a=>{
const li = document.createElement('li');
const an = planetNames[currentLang][a.a] || a.a;
const bn = planetNames[currentLang][a.b] || a.b;
const aspName = aspectTypes[a.type][currentLang];
li.textContent = `${an} ${aspName} ${bn} (orb ${a.orb.toFixed(1)}°)`;
aspList.appendChild(li);
});
if (!state.aspects.length) {
const li = document.createElement('li');
li.textContent = currentLang==='en' ? 'No major aspects within orb.' : 'אין אספקטים עיקריים בתוך אורב.';
aspList.appendChild(li);
}

// lots
const lotList = document.getElementById('lotList');
lotList.innerHTML = '';
state.lots.forEach(L=>{
const li = document.createElement('li');
const name = currentLang==='en' ? L.nameEn : L.nameHe;
const meaning = currentLang==='en' ? L.meaningEn : L.meaningHe;
li.textContent = `${name}: ${formatLon(L.lon, currentLang)} — ${meaning}`;
lotList.appendChild(li);
});

// simple interpretation placeholder (you can replace with your book-based text blocks later)
const interp = document.getElementById('interpText');
interp.textContent = currentLang==='en'
? 'Chart generated successfully. (Replace this paragraph with your literature-based interpretation blocks.)'
: 'המפה נוצרה בהצלחה. (אפשר להחליף פסקה זו בפרשנויות מבוססות ספרות.)';

// svg
drawChartSvg({
svgId: 'chartSvg',
planets: state.planets,
asc: state.asc,
mc: state.mc,
houseCusps: state.houseCusps
});
}

/**********************
* Compute chart pipeline
**********************/
async function computeChartFromForm({googleApiKey}) {
setError(null);

const month = parseInt(document.getElementById('month').value, 10);
const day = parseInt(document.getElementById('day').value, 10);
const year = parseInt(document.getElementById('year').value, 10);

const hour12 = parseInt(document.getElementById('hour').value, 10);
const minute = parseInt(document.getElementById('minute').value, 10);
const ampm = document.getElementById('ampm').value;

const latStr = document.getElementById('lat').value;
const lonStr = document.getElementById('lon').value;

if (!month || !day || !year || !hour12 || isNaN(minute)) {
throw new Error(currentLang==='en' ? 'Please fill date and time.' : 'אנא מלא/י תאריך ושעה.');
}
if (!latStr || !lonStr) {
throw new Error(currentLang==='en'
? 'Please select a location from the dropdown list (so we can get coordinates).'
: 'אנא בחר/י מיקום מהרשימה (כדי לקבל קואורדינטות).');
}

const lat = parseFloat(latStr);
const lon = parseFloat(lonStr);

let hour24 = hour12 % 12;
if (ampm === 'PM') hour24 += 12;

// First: build a UTC timestamp guess from user-entered local time using browser offset (temporary),
// then refine with Time Zone API.
// We'll do it properly:
// 1) Assume local time as if it were UTC => get a rough UTC timestamp
// 2) Query Time Zone API with that rough UTC timestamp, get offset
// 3) Recompute correct UTC moment
const roughUtcMs = Date.UTC(year, month-1, day, hour24, minute, 0);

const tzHours = await fetchTimeZoneOffsetHours({
lat, lon,
utcTimestampSeconds: Math.floor(roughUtcMs/1000),
apiKey: googleApiKey
});

// Correct UTC = local time - tzOffset
const utcMs = Date.UTC(year, month-1, day, hour24, minute, 0) - tzHours*3600*1000;
const time = Astronomy.MakeTime(new Date(utcMs));

const eps = meanObliquityDeg(time);
const lst = localSiderealTimeDeg(time, lon);
const asc = ascendantDeg(lst, lat, eps);
const mc = midheavenDeg(lst, eps);

const houseCusps = equalHousesFromAsc(asc);

// planets
const planets = [
{ key:'Sun', lon: getPlanetLon(Astronomy.Body.Sun, time) },
{ key:'Moon', lon: getPlanetLon(Astronomy.Body.Moon, time) },
{ key:'Mercury', lon: getPlanetLon(Astronomy.Body.Mercury, time) },
{ key:'Venus', lon: getPlanetLon(Astronomy.Body.Venus, time) },
{ key:'Mars', lon: getPlanetLon(Astronomy.Body.Mars, time) },
{ key:'Jupiter', lon: getPlanetLon(Astronomy.Body.Jupiter, time) },
{ key:'Saturn', lon: getPlanetLon(Astronomy.Body.Saturn, time) },
{ key:'Uranus', lon: getPlanetLon(Astronomy.Body.Uranus, time) },
{ key:'Neptune', lon: getPlanetLon(Astronomy.Body.Neptune, time) },
{ key:'Pluto', lon: getPlanetLon(Astronomy.Body.Pluto, time) },
{ key:'Node', lon: getNodeLon(time) }
];

// Determine day/night (Sun above horizon)
// Use Astronomy Engine for altitude:
const observer = new Astronomy.Observer(lat, lon, 0);
const sunHor = Astronomy.Horizon(time, observer, planets[0].lon, 0, 'normal'); // not correct usage (needs RA/Dec)
// Instead: use built-in SearchRiseSet would be heavy. We'll use a robust method:
// Approx rule: if Sun is within houses 7-12 it's above horizon in equal house system.
// We'll compute Sun house with our equal house cusps.
const sunLon = planets.find(p=>p.key==='Sun').lon;
const sunHouse = houseOfLongitude(sunLon, houseCusps);
const isDay = (sunHouse >= 7 && sunHouse <= 12); // equal-house approximation

// Build longs for lots
const byKey = Object.fromEntries(planets.map(p=>[p.key, p.lon]));
const house2 = houseCusps[1];
const house8 = houseCusps[7];
const house9 = houseCusps[8];

const lord2 = rulerLongitude(house2, byKey);
const lord9 = rulerLongitude(house9, byKey);

// We also need “punya” for one lot definition:
const longsBase = {
asc,
sun: byKey.Sun,
moon: byKey.Moon,
merc: byKey.Mercury,
ven: byKey.Venus,
mars: byKey.Mars,
jup: byKey.Jupiter,
sat: byKey.Saturn,
// extra for your formulas:
house2,
house8,
house9,
lord2,
lord9
};

// Compute PoF (punya) first because later lots reference longs.punya
const punya = isDay
? norm360(longsBase.asc + longsBase.moon - longsBase.sun)
: norm360(longsBase.asc + longsBase.sun - longsBase.moon);

const longs = { ...longsBase, punya };

// lots
const lots = lotsDefinitions.map(def=>{
const raw = isDay ? def.day(longs) : def.night(longs);
return { ...def, lon: norm360(raw) };
});

// aspects (exclude ASC/MC)
const aspects = computeAspects(planets);

return {
timeUtcMs: utcMs,
tzHours,
lat, lon,
eps, lst,
asc, mc,
houseCusps,
planets,
aspects,
lots,
isDay
};
}

function houseOfLongitude(lon, houseCusps) {
// houseCusps in increasing order but wrap at 360; we handle by shifting relative to house1
const a = houseCusps[0];
const rel = norm360(lon - a);
const idx = Math.floor(rel / 30); // equal houses
return idx + 1;
}

function signOfLongitude(lon) {
const idx = Math.floor(norm360(lon)/30);
return signsEn[idx];
}

function rulerLongitude(cuspLon, planetLonByKey) {
const sign = signOfLongitude(cuspLon);
const ruler = signRulers[sign];
const lon = planetLonByKey[ruler];
// if missing (shouldn't), fallback to 0
return (typeof lon === 'number') ? lon : 0;
}

/**********************
* Form submit
**********************/
const GOOGLE_API_KEY = 'AIzaSyCaCfPdQCwYnssAEUM8TeDsm1sWKqLJ-CQ'; // <-- replace
document.getElementById('birthForm').addEventListener('submit', async (e) => {
e.preventDefault();
try {
if (!GOOGLE_API_KEY || GOOGLE_API_KEY === 'YOUR_GOOGLE_API_KEY') {
throw new Error(currentLang==='en'
? 'Set your Google API key in the index.html (GOOGLE_API_KEY).'
: 'הכנס/י את מפתח ה-API של Google בקובץ index.html (GOOGLE_API_KEY).');
}
const state = await computeChartFromForm({googleApiKey: GOOGLE_API_KEY});
lastChartState = state;
renderAll(state);
setError(null);
} catch (err) {
console.error(err);
setError(err.message || String(err));
}
});

</script>

<!-- Google Maps JS (Places) with callback for reliable init -->
<script
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCaCfPdQCwYnssAEUM8TeDsm1sWKqLJ-CQ&libraries=places&callback=initAutocomplete"
async defer></script>
</body>
</html>
